<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Synthesis Report - Refactored</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* For browsers that might not support all tailwind features smoothly */
        .prose { max-width: 65ch; }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <header class="bg-red-800 text-white p-6">
            <h1 class="text-2xl md:text-3xl font-bold">High-Yield Bond Shows Elevated Risk Profile Amid Market Uncertainty</h1>
            <div class="mt-2 text-sm opacity-90">
                <strong>Context:</strong> Bear_Flattener (High Volatility)
                <br>
                <em>Note: Risk scores have been adjusted based on the current market regime.</em>
            </div>
        </header>

        <main class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
                <!-- Left Column: Key Insights -->
                <section>
                    <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Key Insights (Cross-Factor Analysis)</h2>
                    <div id="insights-container" class="space-y-4">
                        <!-- Insights will be dynamically added or can be pre-rendered -->
                    </div>
                </section>

                <!-- Right Column: Risk Factors -->
                <section>
                    <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">All Risk Factors (Normalized 0-1 Score)</h2>
                    <div class="risk-factors-grid space-y-4" id="risk-factors-container">
                        <!-- Risk factors will be dynamically added here -->
                    </div>
                </section>
            </div>
            
            <!-- Quantitative Metrics Section -->
            <section class="mt-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Quantitative Metrics Summary</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                         <thead class="bg-gray-50">
                            <tr>
                                <th class="p-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Category</th>
                                <th class="p-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Metric</th>
                                <th class="p-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Value</th>
                            </tr>
                        </thead>
                        <tbody id="metrics-table-body" class="divide-y divide-gray-200">
                            <!-- Metrics data will be dynamically added -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Collapsible Narrative Section -->
            <section class="mt-8">
                <div class="border-t border-gray-200 pt-6">
                     <details id="narrative-details">
                        <summary class="flex justify-between items-center cursor-pointer text-xl font-bold text-gray-900">
                            <span>Market-Adjusted Risk Narrative</span>
                            <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div id="narrative-content" class="mt-4 prose prose-indigo max-w-none text-gray-700 leading-relaxed">
                            <!-- Narrative content will be populated here -->
                        </div>
                    </details>
                </div>
            </section>
        </main>
    </div>

    <script>
        const mockData = {
          headline: "High-Yield Bond Shows Elevated Risk Profile Amid Market Uncertainty",
          synthesized_narrative: "This high-yield corporate bond exhibits a complex and concerning risk profile. It is trading significantly 'rich' to its peers against a backdrop of a 'Bear_Flattener' market regime, a condition amplified by models forecasting continued credit spread widening. The situation is exacerbated by high illiquidity, casting doubt on the reliability of current price marks. Both recent and predicted volatility are high and accelerating, signaling a sustained period of instability. A key contradiction emerges between positive news sentiment and significant net selling pressure, suggesting sophisticated investors may be using the news as a liquidity event to exit positions. While fundamentals are weak, some contrarian buying is detected, pointing to a small pocket of investors betting on a turnaround.",
          risk_factors: [
            { risk_type: "Valuation", description: "Measures if the instrument is overvalued ('rich') relative to its peers and benchmark, adjusted for market volatility.", score: 0.85, evidence: [ {name: "Spread vs. Peers (bps)", value: "22.3"}, {name: "Peer Valuation Threshold (bps)", value: "25"}, {name: "Spread vs. Benchmark (bps)", value: "38.1"}, {name: "Benchmark Valuation Threshold (bps)", value: "40"}, {name: "Volatility Regime", value: "High"} ] },
            { risk_type: "Predicted Spread Widening", description: "Measures the risk of underperformance due to a model-forecasted increase in the instrument's credit spread.", score: 0.82, evidence: [ {name: "1d Forecast Spread Widening (bps)", value: "12"}, {name: "1d Spread Widening Threshold (bps)", value: "15"}, {name: "5d Forecast Spread Widening (bps)", value: "28"}, {name: "5d Spread Widening Threshold (bps)", value: "30"}, {name: "20d Forecast Spread Widening (bps)", value: "45"}, {name: "20d Spread Widening Threshold (bps)", value: "50"}, {name: "Driver: VIX Index", value: "0.35"}, {name: "Driver: HYG ETF Flow", value: "0.25"}, {name: "Model Precision", value: "0.88"}, {name: "Model Recall", value: "0.85"} ] },
            { risk_type: "Illiquidity", description: "Evaluates the difficulty of trading the bond at its current marked price without significant price impact.", score: 0.78, evidence: [{name: "Composite z-score", value: "-2.1"}, {name: "Bid/Ask Spread", value: "Wide"}, {name: "Recent Trade Volume", value: "Low"}] },
            { risk_type: "Volatility Trend", description: "Measures the acceleration of recent price volatility, indicating increasing instability.", score: 0.75, evidence: [{name: "5d vs 20d Volatility", value: "1.8x"}, {name: "Trend Significance", value: "High"}] },
            { risk_type: "Issuer & Covenant Risk", description: "Assesses risks related to the issuer's financial health and breaches of bond covenants.", score: 0.72, evidence: [{name: "DSCR", value: "1.15x"}, {name: "Covenant Status", value: "Breached"}, {name: "Sector Outlook", value: "Negative"}] },
            { risk_type: "Order Flow Pressure", description: "Indicates net buying (negative score) or selling (positive score) pressure from market participants.", score: 0.65, evidence: [{name: "Net Flow (5d)", value: "$2.5M Sell"}, {name: "Institutional Flow", value: "Net Sell"}] },
            { risk_type: "Predicted Volatility", description: "Forecasts future volatility (e.g., VaR), signaling expectations of future price swings.", score: 0.91, evidence: [{name: "5d VaR Forecast", value: "1.8%"}, {name: "Model Accuracy", value: "91%"}] },
            { risk_type: "News Sentiment", description: "Gauges risk from negative news sentiment. A low score indicates positive news.", score: 0.25, evidence: [{name: "Sentiment Score", value: "0.8 (Positive)"}, {name: "Key Stories", value: "Upbeat earnings report"}] }
          ],
          pattern_analysis: [
            { pattern_type: "Confirmation (Fundamental + Forecast)", insight_summary: "Instrument is trading rich and models forecast further spread widening, confirming valuation concerns.", contributing_factors: ["Valuation Risk Score > 0.7", "Predicted Spread Widening Risk Score > 0.7"]},
            { pattern_type: "Contradiction (Sentiment vs. Flow)", insight_summary: "Despite positive news sentiment, order flows show significant net selling, indicating market participants may be disbelieving the news or using it as a liquidity event.", contributing_factors: ["News Risk Score < 0.3", "Order Flow Pressure Score > 0.7"]},
            { pattern_type: "Confirmation (Bottom Fishing / Contrarian Buying)", insight_summary: "Despite deteriorating fundamentals, order flow shows persistent net buying, suggesting some participants see value where others see risk.", contributing_factors: ["Issuer & Covenant Risk Score > 0.7", "Order Flow Pressure Score < -0.7"]},
            { pattern_type: "Contradiction (Illiquid & Overvalued)", insight_summary: "The bond is marked as both highly illiquid and significantly overvalued. Its 'richness' may be an artifact of stale, unreliable pricing rather than true market value.", contributing_factors: ["Illiquidity Risk is 'High'", "Valuation Risk Score > 0.7"]},
            { pattern_type: "Confirmation (Volatility Cluster)", insight_summary: "Accelerating realized volatility is confirmed by forecasts, suggesting a sustained high-risk volatility regime.", contributing_factors: ["Volatility Trend Risk Score > 0.7", "Predicted Volatility Risk Score > 0.7"]}
          ],
          quantitative_metrics: [
            { category: "Valuation", metric: "YTW / YTM", value: "8.1% / 8.5%" },
            { category: "Valuation", metric: "OAS (bps)", value: "450" },
            { category: "Valuation", metric: "Relative Value vs Peers (bps)", value: "-22.3 (Rich)" },
            { category: "Valuation", metric: "Relative Value vs Benchmark (bps)", value: "-38.1 (Rich)" },
            { category: "Sensitivity", metric: "DV01 / CS01", value: "0.08 / 0.33" },
            { category: "Liquidity", metric: "Composite Score (z-score)", value: "-2.1 (Illiquid)" },
            { category: "Liquidity", metric: "Bid / Ask Depth ($)", value: "150k / 100k" },
            { category: "Fundamentals", metric: "Issuer DSCR", value: "1.15x (Breached Covenant)" },
            { category: "Fundamentals", metric: "State Fiscal Health", value: "N/A (Corporate Issuer)" },
            { category: "Supplemental", metric: "Ownership", value: "Concentrated (Top 3 own 85%)" },
            { category: "Supplemental", metric: "Cost of Carry (bps)", value: "-15 bps" },
            { category: "Supplemental", metric: "Correlation (60d)", value: "SPY: 0.75" },
            { category: "Supplemental", metric: "Tax Profile", value: "N/A" },
            { category: "Supplemental", metric: "Call Risk", value: "High - Trading to 1y call" },
            { category: "Forecasts (5d)", metric: "Prob. Negative News", value: "70% (Acc: 0.82)" },
            { category: "Forecasts (5d)", metric: "Spread Widening (bps)", value: "28 (Acc: 0.88)" },
            { category: "Forecasts (5d)", metric: "Volatility (VaR)", value: "1.8% (Acc: 0.91)" }
          ]
        };

        function getScoreClass(score, isPressure = false) {
            if (isPressure) {
                if (score > 0.5) return 'bg-red-600'; // High selling pressure -> High risk
                if (score < -0.5) return 'bg-green-600'; // High buying pressure -> Low risk
                return 'bg-yellow-500'; // Neutral
            }
            if (score >= 0.7) return 'bg-red-600'; // High risk
            if (score >= 0.4) return 'bg-yellow-500'; // Medium risk
            return 'bg-green-600'; // Low risk
        }

        function buildRiskFactors(data) {
            const container = document.getElementById('risk-factors-container');
            if (!container) return;
            container.innerHTML = '';
            data.forEach((factor, index) => {
                const scoreClass = getScoreClass(factor.score, factor.risk_type === 'Order Flow Pressure');
                const card = document.createElement('div');
                card.className = 'bg-gray-50 border border-gray-200 rounded-lg p-4 transition-shadow hover:shadow-md';
                card.innerHTML = `
                    <div class="flex justify-between items-center font-bold text-gray-800">
                        <span>${factor.risk_type}</span>
                        <span class="px-2 py-1 rounded-full text-white text-xs font-semibold ${scoreClass}">${factor.score.toFixed(2)}</span>
                    </div>
                    <p class="text-sm text-gray-600 my-3 italic">${factor.description}</p>
                    <details class="text-sm group">
                        <summary class="list-none flex items-center cursor-pointer font-semibold text-indigo-600 hover:text-indigo-800">
                            Show Evidence
                            <svg class="w-4 h-4 ml-1 transform group-open:-rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <ul class="space-y-1 text-gray-500">
                                ${factor.evidence.map(e => `<li><span class="font-semibold text-gray-600">${e.name}:</span> ${e.value}</li>`).join('')}
                            </ul>
                        </div>
                    </details>
                `;
                container.appendChild(card);
            });
        }

        function buildInsights(data) {
            const container = document.getElementById('insights-container');
            if (!container) return;
            container.innerHTML = '';
            data.forEach(insight => {
                const card = document.createElement('div');
                card.className = 'bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg';
                card.innerHTML = `
                    <div class="font-bold text-base text-yellow-800">${insight.pattern_type}</div>
                    <p class="my-1 text-sm text-gray-700">${insight.insight_summary}</p>
                    <p class="text-xs text-gray-500 italic">Factors: ${insight.contributing_factors.join(', ')}</p>
                `;
                container.appendChild(card);
            });
        }

        function buildMetrics(data) {
            const container = document.getElementById('metrics-table-body');
            if (!container) return;
            container.innerHTML = '';
            let lastCategory = '';
            data.forEach(metric => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-3">
                        ${metric.category !== lastCategory ? `<span class="font-bold text-gray-800">${metric.category}</span>` : ''}
                    </td>
                    <td class="p-3 text-gray-600">${metric.metric}</td>
                    <td class="p-3 text-gray-800 font-medium">${metric.value}</td>
                `;
                container.appendChild(row);
                lastCategory = metric.category;
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // Populate Narrative
            const narrativeContent = document.getElementById('narrative-content');
            if(narrativeContent) {
                narrativeContent.innerHTML = `<p>${mockData.synthesized_narrative}</p>`;
            }

            // Build dynamic sections
            buildRiskFactors(mockData.risk_factors);
            buildInsights(mockData.pattern_analysis);
            buildMetrics(mockData.quantitative_metrics);

            // Handle evidence toggle text
            document.querySelectorAll('#risk-factors-container details').forEach(detail => {
                const summary = detail.querySelector('summary');
                if(!summary) return;
                const originalText = summary.firstChild.textContent.trim();
                
                detail.addEventListener('toggle', () => {
                    if (detail.open) {
                        summary.firstChild.textContent = 'Hide Evidence ';
                    } else {
                        summary.firstChild.textContent = originalText + ' ';
                    }
                });
            });

             // Handle narrative toggle arrow
            const narrativeDetails = document.getElementById('narrative-details');
            if(narrativeDetails) {
                const arrow = narrativeDetails.querySelector('svg');
                narrativeDetails.addEventListener('toggle', () => {
                    arrow.classList.toggle('-rotate-180');
                });
            }
        });

    </script>
</body>
</html> 